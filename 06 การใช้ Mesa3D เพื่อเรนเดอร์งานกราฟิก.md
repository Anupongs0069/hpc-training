### **ЁЯЦея╕П р╕Др╕╣р╣Ир╕бр╕╖р╕нр╕Эр╕╢р╕Бр╕нр╕Ър╕гр╕б: р╕Бр╕▓р╕гр╣Гр╕Кр╣Йр╕Зр╕▓р╕Щ Mesa 3D р╣Бр╕ер╕░ OpenGL р╕Ър╕Щ LANTA Supercomputer**  
**ЁЯУМ р╕зр╕▒р╕Хр╕Цр╕╕р╕Ыр╕гр╕░р╕кр╕Зр╕Др╣М:**  
тЬЕ р╣Гр╕Кр╣Й **Mesa 3D** р╕Ър╕Щ LANTA р╕кр╕│р╕лр╕гр╕▒р╕Ъ **Off-Screen Rendering** (р╣Др╕бр╣Ир╕бр╕╡ GUI)  
тЬЕ р╣Ар╕гр╕╡р╕вр╕Щр╕гр╕╣р╣Йр╕Бр╕▓р╕гр╣Гр╕Кр╣Й **OSMesa** р╣Ар╕Юр╕╖р╣Ир╕нр╕кр╕гр╣Йр╕▓р╕Зр╕Бр╕гр╕▓р╕Яр╕┤р╕Б 3D р╕Ър╕Щ HPC  
тЬЕ р╕Эр╕╢р╕Бр╕Бр╕▓р╕гр╣Гр╕Кр╣Й **Slurm Job Scheduling** р╣Ар╕Юр╕╖р╣Ир╕нр╕гр╕▒р╕Щр╕Зр╕▓р╕Щ OpenGL р╕Ър╕Щ Compute Node  

---

# **ЁЯФ╣ 1. р╕Чр╕│р╣Др╕бр╕Хр╣Йр╕нр╕Зр╣Гр╕Кр╣Й HPC р╕кр╕│р╕лр╕гр╕▒р╕Ър╕Бр╕▓р╕гр╣Ар╕гр╕Щр╣Ар╕Фр╕нр╕гр╣М 3D?**
ЁЯТб **HPC (High-Performance Computing) р╕бр╕╡р╕Вр╣Йр╕нр╕Фр╕╡р╣Ар╕лр╕Щр╕╖р╕нр╕Бр╕зр╣Ир╕▓р╕Др╕нр╕бр╕Юр╕┤р╕зр╣Ар╕Хр╕нр╕гр╣Мр╕Чр╕▒р╣Ир╕зр╣Др╕Ы**  
| **р╕Ыр╕▒р╕Ир╕Ир╕▒р╕в** | **PC р╕Чр╕▒р╣Ир╕зр╣Др╕Ы** | **HPC LANTA** |
|-----------|------------|------------------|
| р╕Юр╕ер╕▒р╕Зр╕Ыр╕гр╕░р╕бр╕зр╕ер╕Ьр╕е | **CPU 4-8 р╕Др╕нр╕гр╣М** | **128 р╕Др╕нр╕гр╣Мр╕Вр╕╢р╣Йр╕Щр╣Др╕Ы** |
| GPU | **р╕Вр╕╢р╣Йр╕Щр╕Бр╕▒р╕Ър╕ор╕▓р╕гр╣Мр╕Фр╣Бр╕зр╕гр╣М** | **р╣Гр╕Кр╣Й CPU р╣Ар╕гр╕Щр╣Ар╕Фр╕нр╕гр╣Мр╣Бр╕Чр╕Щ** (OSMesa) |
| р╕Вр╕Щр╕▓р╕Фр╕ар╕▓р╕Юр╕Чр╕╡р╣Ир╕гр╕нр╕Зр╕гр╕▒р╕Ъ | **р╣Др╕бр╣Ир╣Ар╕Бр╕┤р╕Щ 4K** | **р╕гр╕нр╕Зр╕гр╕▒р╕Ър╕ар╕▓р╕Юр╕Др╕зр╕▓р╕бр╕ер╕░р╣Ар╕нр╕╡р╕вр╕Фр╕кр╕╣р╕З 16K+** |
| р╕Ыр╕гр╕░р╕кр╕┤р╕Чр╕Шр╕┤р╕ар╕▓р╕Ю | **р╕Кр╣Йр╕▓р╣Гр╕Щр╕Бр╕▓р╕гр╣Ар╕гр╕Щр╣Ар╕Фр╕нр╕гр╣Мр╣Гр╕лр╕Нр╣И р╣Ж** | **р╕гр╕▒р╕Щр╕Юр╕гр╣Йр╕нр╕бр╕Бр╕▒р╕Щр╕лр╕ер╕▓р╕вр╕Зр╕▓р╕Щр╣Др╕Фр╣Й** |

тЬЕ **LANTA Supercomputer р╕кр╕▓р╕бр╕▓р╕гр╕Цр╕гр╕▒р╕Щр╕Бр╕▓р╕гр╣Ар╕гр╕Щр╣Ар╕Фр╕нр╕гр╣Мр╕Вр╕Щр╕▓р╕Фр╣Гр╕лр╕Нр╣Ир╕Чр╕╡р╣Ир╕Хр╣Йр╕нр╕Зр╣Гр╕Кр╣Йр╕Юр╕ер╕▒р╕Зр╕Др╕│р╕Щр╕зр╕Ур╕кр╕╣р╕Зр╣Др╕Фр╣Йр╣Гр╕Щр╣Ар╕зр╕ер╕▓р╕кр╕▒р╣Йр╕Щ р╣Ж!** ЁЯЪА  

> ЁЯУМ **Mesa 3D р╕Ър╕Щ LANTA р╕гр╕нр╕Зр╕гр╕▒р╕Ър╕Бр╕▓р╕гр╣Ар╕гр╕Щр╣Ар╕Фр╕нр╕гр╣Мр╣Бр╕Ър╕Ъ "Off-Screen" р╣Ар╕Чр╣Ир╕▓р╕Щр╕▒р╣Йр╕Щ (р╣Др╕бр╣Ир╕бр╕╡ GUI) р╣Вр╕Фр╕вр╣Гр╕Кр╣Й OSMesa**

---

# **ЁЯФ╣ 2. р╕Бр╕▓р╕гр╣Ар╕Вр╣Йр╕▓р╕кр╕╣р╣Ир╕гр╕░р╕Ър╕Ъ LANTA**
1я╕ПтГг **р╣Ар╕Ыр╕┤р╕Ф Terminal р╕лр╕гр╕╖р╕н MobaXterm**  
2я╕ПтГг **р╣Ар╕Кр╕╖р╣Ир╕нр╕бр╕Хр╣Ир╕нр╣Ар╕Вр╣Йр╕▓р╕кр╕╣р╣И LANTA**
```bash
ssh hpcuser@lanta.nstda.or.th
```

---

# **ЁЯФ╣ 3. р╣Вр╕лр╕ер╕Ф Mesa 3D р╣Бр╕ер╕░р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕Бр╕▓р╕гр╕Хр╕┤р╕Фр╕Хр╕▒р╣Йр╕З**
ЁЯУМ **р╣Гр╕Кр╣Й `module load` р╣Ар╕Юр╕╖р╣Ир╕нр╕Хр╕▒р╣Йр╕Зр╕Др╣Ир╕▓р╕кр╕ар╕▓р╕Юр╣Бр╕зр╕Фр╕ер╣Йр╕нр╕б**
```bash
module load Mesa/23.1.9-cpeIntel-23.09
```

ЁЯУМ **р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕зр╣Ир╕▓ Mesa р╕Цр╕╣р╕Бр╣Вр╕лр╕ер╕Фр╕кр╕│р╣Ар╕гр╣Зр╕И**
```bash
echo $LD_LIBRARY_PATH
```
тЬЕ р╕Др╕╕р╕Ур╕Др╕зр╕гр╣Ар╕лр╣Зр╕Щ `/opt/cray/pe/Mesa/23.1.9-cpeIntel-23.09/lib64` р╕Лр╕╢р╣Ир╕Зр╕лр╕бр╕▓р╕вр╕Др╕зр╕▓р╕бр╕зр╣Ир╕▓ Mesa р╕Цр╕╣р╕Бр╣Вр╕лр╕ер╕Фр╣Ар╕гр╕╡р╕вр╕Ър╕гр╣Йр╕нр╕вр╣Бр╕ер╣Йр╕з  

> тЭМ **LANTA р╣Др╕бр╣Ир╕бр╕╡ `glxinfo` р╣Ар╕Юр╕гр╕▓р╕░р╣Др╕бр╣Ир╕бр╕╡ GUI**  
> **р╣Ар╕гр╕▓р╕Ир╕░р╣Гр╕Кр╣Й OSMesa р╣Бр╕Чр╕Щ**

---

# **ЁЯФ╣ 4. р╕Бр╕▓р╕гр╣Ар╕Вр╕╡р╕вр╕Щр╣Вр╕Др╣Йр╕Ф OpenGL р╕кр╕│р╕лр╕гр╕▒р╕Ъ Off-Screen Rendering**
ЁЯУМ **р╕кр╕гр╣Йр╕▓р╕Зр╣Др╕Яр╕ер╣Мр╣Вр╕Др╣Йр╕Ф**
```bash
nano offscreen_opengl.c
```

ЁЯУД **р╕Др╕▒р╕Фр╕ер╕нр╕Бр╣Вр╕Др╣Йр╕Фр╕Хр╣Ир╕нр╣Др╕Ыр╕Щр╕╡р╣Йр╕ер╕Зр╣Гр╕Щр╣Др╕Яр╕ер╣М `offscreen_opengl.c`**
```c
#include <GL/osmesa.h>
#include <GL/gl.h>
#include <stdio.h>

#define WIDTH 800
#define HEIGHT 600

int main() {
    OSMesaContext ctx = OSMesaCreateContext(GL_RGBA, NULL);
    unsigned char buffer[WIDTH * HEIGHT * 4];
    
    if (!OSMesaMakeCurrent(ctx, buffer, GL_UNSIGNED_BYTE, WIDTH, HEIGHT)) {
        printf("Failed to create OSMesa context!\n");
        return 1;
    }

    glClearColor(1.0, 0.0, 0.0, 1.0); // р╕Хр╕▒р╣Йр╕Зр╕Др╣Ир╕▓р╕Юр╕╖р╣Йр╕Щр╕лр╕ер╕▒р╕Зр╣Ар╕Ыр╣Зр╕Щр╕кр╕╡р╣Бр╕Фр╕З
    glClear(GL_COLOR_BUFFER_BIT);
    glFlush();

    FILE *fp = fopen("output.ppm", "wb");
    fprintf(fp, "P6\n%d %d\n255\n", WIDTH, HEIGHT);
    fwrite(buffer, 1, WIDTH * HEIGHT * 3, fp);
    fclose(fp);

    OSMesaDestroyContext(ctx);
    printf("Rendered output.ppm successfully!\n");
    return 0;
}
```

тЬЕ **р╣Вр╕Др╣Йр╕Фр╕Щр╕╡р╣Йр╕Ир╕░р╣Ар╕гр╕Щр╣Ар╕Фр╕нр╕гр╣Мр╕Юр╕╖р╣Йр╕Щр╕лр╕ер╕▒р╕Зр╕кр╕╡р╣Бр╕Фр╕Зр╕ер╕Зр╣Гр╕Щр╣Др╕Яр╕ер╣М `output.ppm` р╣Вр╕Фр╕вр╣Др╕бр╣Ир╕Хр╣Йр╕нр╕Зр╣Гр╕Кр╣Йр╕Ир╕нр╣Бр╕кр╕Фр╕Зр╕Ьр╕е**

---

# **ЁЯФ╣ 5. р╕Др╕нр╕бр╣Др╕Юр╕ер╣Мр╣Вр╕Др╣Йр╕Ф**
ЁЯУМ **р╣Гр╕Кр╣Й Mesa 3D Library (`OSMesa`) р╣Ар╕Юр╕╖р╣Ир╕нр╕Др╕нр╕бр╣Др╕Юр╕ер╣М**
```bash
gcc offscreen_opengl.c -o offscreen_opengl -lOSMesa
```
тЬЕ р╕Цр╣Йр╕▓р╕Др╕нр╕бр╣Др╕Юр╕ер╣Мр╕Ьр╣Ир╕▓р╕Щ р╕Ир╕░р╣Др╕Фр╣Йр╣Др╕Яр╕ер╣М `offscreen_opengl` р╕Юр╕гр╣Йр╕нр╕бр╣Гр╕Кр╣Йр╕Зр╕▓р╕Щ  

---

# **ЁЯФ╣ 6. р╕гр╕▒р╕Щ OpenGL Off-Screen Rendering р╕Ър╕Щ Compute Node**
ЁЯУМ **р╕гр╕▒р╕Щр╣Вр╕Ыр╕гр╣Бр╕Бр╕гр╕б**
```bash
./offscreen_opengl
```
тЬЕ р╕Цр╣Йр╕▓р╕кр╕│р╣Ар╕гр╣Зр╕И р╕Др╕╕р╕Ур╕Ир╕░р╣Ар╕лр╣Зр╕Щр╕Вр╣Йр╕нр╕Др╕зр╕▓р╕б:
```
Rendered output.ppm successfully!
```
ЁЯУМ **р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕Ьр╕ер╕ер╕▒р╕Юр╕Шр╣М**
```bash
ls -lh output.ppm
```
тЬЕ р╕Др╕╕р╕Ур╕Др╕зр╕гр╣Ар╕лр╣Зр╕Щр╣Др╕Яр╕ер╣М `output.ppm` р╕Чр╕╡р╣Ир╕кр╕гр╣Йр╕▓р╕Зр╕Вр╕╢р╣Йр╕Щр╕бр╕▓

---

# **ЁЯФ╣ 7. р╕Фр╕╣р╕Ьр╕ер╕ер╕▒р╕Юр╕Шр╣М (р╣Др╕бр╣Ир╕бр╕╡ GUI)**
**р╕Цр╣Йр╕▓р╣Др╕бр╣Ир╕бр╕╡р╣Вр╕Ыр╕гр╣Бр╕Бр╕гр╕бр╕Фр╕╣р╕ар╕▓р╕Юр╕Ър╕Щ LANTA р╣Ар╕гр╕▓р╕Хр╣Йр╕нр╕Зр╕Фр╕▓р╕зр╕Щр╣Мр╣Вр╕лр╕ер╕Фр╕бр╕▓р╕Фр╕╣р╕Ър╕Щр╣Ар╕Др╕гр╕╖р╣Ир╕нр╕Зр╣Ар╕гр╕▓р╣Ар╕нр╕З**
ЁЯУМ **р╕Фр╕▓р╕зр╕Щр╣Мр╣Вр╕лр╕ер╕Фр╣Др╕Яр╕ер╣Мр╕Бр╕ер╕▒р╕Ър╕бр╕▓р╕Чр╕╡р╣Ир╣Ар╕Др╕гр╕╖р╣Ир╕нр╕З**
```bash
scp hpcuser@transfer.lanta.nstda.or.th:/home/hpcuser/output.ppm .
```
ЁЯУМ **р╣Ар╕Ыр╕┤р╕Фр╕ар╕▓р╕Юр╕Фр╣Йр╕зр╕в ImageMagick**
```bash
display output.ppm
```
тЬЕ р╕Др╕╕р╕Ур╕Ир╕░р╣Ар╕лр╣Зр╕Щ **р╕Юр╕╖р╣Йр╕Щр╕лр╕ер╕▒р╕Зр╕кр╕╡р╣Бр╕Фр╕З** р╕Чр╕╡р╣Ир╣Ар╕гр╕Щр╣Ар╕Фр╕нр╕гр╣Мр╣Вр╕Фр╕в OSMesa ЁЯОи  

---

# **ЁЯФ╣ 8. р╕гр╕▒р╕Щ OpenGL Rendering р╕Ьр╣Ир╕▓р╕Щ Slurm**
ЁЯУМ **р╕кр╕гр╣Йр╕▓р╕Зр╣Др╕Яр╕ер╣М `submit_mesa.sh`**
```bash
nano submit_mesa.sh
```

ЁЯУД **р╣Ар╕Юр╕┤р╣Ир╕бр╣Вр╕Др╣Йр╕Фр╕Щр╕╡р╣Йр╕ер╕Зр╣Др╕Ы**
```bash
#!/bin/bash
#SBATCH -p compute
#SBATCH -N 1
#SBATCH --ntasks=1
#SBATCH -t 00:30:00
#SBATCH -J mesa_test
#SBATCH -A cb9009xx

module load Mesa/23.1.9-cpeIntel-23.09

./offscreen_opengl
```
ЁЯУМ **р╕кр╣Ир╕Зр╕Зр╕▓р╕Щр╣Др╕Ыр╕Чр╕╡р╣И HPC**
```bash
sbatch submit_mesa.sh
```
ЁЯУМ **р╣Ар╕Кр╣Зр╕Др╕кр╕Цр╕▓р╕Щр╕░р╕Зр╕▓р╕Щ**
```bash
myqueue
```
ЁЯУМ **р╣Ар╕Кр╣Зр╕Др╕Ьр╕ер╕ер╕▒р╕Юр╕Шр╣М**
```bash
cat slurm-xxxxx.out
ls -lh output.ppm
```
тЬЕ р╕Др╕╕р╕Ур╕Ир╕░р╣Ар╕лр╣Зр╕Щр╕зр╣Ир╕▓ **р╣Др╕Яр╕ер╣М `output.ppm` р╕Цр╕╣р╕Бр╕кр╕гр╣Йр╕▓р╕Зр╣Вр╕Фр╕в Compute Node**

---

# **ЁЯФ╣ 9. р╕кр╕гр╕╕р╕Ы**
тЬЕ **р╣Гр╕Кр╣Й Mesa 3D (OSMesa) р╕кр╕│р╕лр╕гр╕▒р╕Ъ Off-Screen Rendering р╕Ър╕Щ HPC**  
тЬЕ **р╕кр╕гр╣Йр╕▓р╕З OpenGL р╣Вр╕Др╣Йр╕Фр╣Вр╕Фр╕вр╣Др╕бр╣Ир╕Хр╣Йр╕нр╕Зр╣Гр╕Кр╣Й GUI**  
тЬЕ **р╕гр╕▒р╕Щ OpenGL р╕Ьр╣Ир╕▓р╕Щ Slurm Job Scheduler р╕Ър╕Щ Compute Node**  
тЬЕ **р╕Фр╕▓р╕зр╕Щр╣Мр╣Вр╕лр╕ер╕Фр╕Ьр╕ер╕ер╕▒р╕Юр╕Шр╣Мр╕Бр╕ер╕▒р╕Ър╕бр╕▓р╣Ар╕Ыр╕┤р╕Фр╕Ър╕Щр╣Ар╕Др╕гр╕╖р╣Ир╕нр╕Зр╕кр╣Ир╕зр╕Щр╕Хр╕▒р╕з**  

ЁЯЪА **р╕Хр╕нр╕Щр╕Щр╕╡р╣Йр╕Др╕╕р╕Ур╕кр╕▓р╕бр╕▓р╕гр╕Цр╣Гр╕Кр╣Й HPC р╣Ар╕Юр╕╖р╣Ир╕нр╣Ар╕гр╕Щр╣Ар╕Фр╕нр╕гр╣М OpenGL р╣Бр╕Ър╕Ъ Off-Screen р╣Др╕Фр╣Йр╣Бр╕ер╣Йр╕з!** ЁЯОЙ  

---

> ЁЯУМ **р╣Бр╕лр╕ер╣Ир╕Зр╕нр╣Йр╕▓р╕Зр╕нр╕┤р╕З (Citations):**  
> - ThaiSC LANTA User Guide   
> - Mesa 3D Documentation: [https://docs.mesa3d.org/](https://docs.mesa3d.org/)  
> - OSMesa API Reference   

ЁЯОи **р╕нр╕вр╕▓р╕Бр╕ер╕нр╕Зр╣Ар╕Юр╕┤р╣Ир╕бр╕гр╕▓р╕вр╕ер╕░р╣Ар╕нр╕╡р╕вр╕Фр╣Гр╕Щр╕Бр╕▓р╕гр╣Ар╕гр╕Щр╣Ар╕Фр╕нр╕гр╣М?**  
ЁЯТб **р╕ер╕нр╕Зр╣Ар╕Юр╕┤р╣Ир╕бр╕зр╕▒р╕Хр╕Цр╕╕ 3D р╕лр╕гр╕╖р╕нр╣Гр╕Кр╣Й OpenGL Shader р╕Фр╕╣р╕Щр╕░р╕Др╕░!** ЁЯЪА

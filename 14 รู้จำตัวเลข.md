# 14 รู้จำตัวเลขที่เขียนด้วยลายมือ

## พื้นฐานทางทฤษฎี

**1. Neural Network คืออะไร?**  
Neural Network (เครือข่ายประสาทเทียม) เป็นแบบจำลองทางคณิตศาสตร์ที่ได้รับแรงบันดาลใจจากสมองมนุษย์ ประกอบด้วย "เซลล์ประสาท" (neurons) ที่เชื่อมต่อกันผ่าน "ซินแนปส์" (synapses) ซึ่งแต่ละเซลล์จะรับข้อมูลและประมวลผลข้อมูลนั้นผ่านฟังก์ชันทางคณิตศาสตร์ เช่น ฟังก์ชัน activation เพื่อให้ได้ผลลัพธ์สุดท้าย

**2. Convolutional Neural Network (CNN)**  
CNN ถูกออกแบบมาเพื่อประมวลผลข้อมูลที่มีโครงสร้างเป็นตาราง เช่น รูปภาพ โดยใช้เลเยอร์ convolution ที่ช่วยจับลักษณะเด่นของข้อมูลในรูปแบบของ pattern ต่าง ๆ เช่น ขอบ รูปร่าง และลวดลาย ภายในโปรเจ็กต์นี้ เราจะใช้ CNN ในการจำแนกรูปภาพตัวเลขจากชุดข้อมูล MNIST

**3. Distributed Data Parallel (DDP)**  
การฝึก Neural Network ในงานจริงอาจต้องใช้เวลานาน เนื่องจากข้อมูลและโมเดลมีขนาดใหญ่ DDP ช่วยให้การฝึกกระจายงานไปยังหลาย ๆ GPU ทำให้การฝึกเป็นไปอย่างรวดเร็วและมีประสิทธิภาพมากขึ้น  
- DDP แบ่งข้อมูลออกเป็นส่วน ๆ เพื่อให้แต่ละ GPU ฝึกโมเดลในส่วนของตัวเองพร้อมกัน จากนั้นจะรวมผลการฝึกเพื่อปรับปรุงโมเดลให้ดีที่สุด  
- การใช้ DDP ต้องมีการตั้งค่า environment variables ที่เหมาะสม (เช่น MASTER_PORT, WORLD_SIZE เป็นต้น) ซึ่งสามารถดูรายละเอียดได้ในไฟล์ `submit.sh` citeturn0file3

**4. แนวคิดสำคัญอื่น ๆ**  
- **Gradient Descent และ Backpropagation:** วิธีการปรับปรุงน้ำหนักของ Neural Network โดยค่อย ๆ ลดค่า loss ที่เกิดขึ้นระหว่างการฝึก  
- **Dropout:** เทคนิคที่ช่วยลดการ overfitting โดยการสุ่มปิดการทำงานของเซลล์บางส่วนระหว่างการฝึก เพื่อให้โมเดลไม่พึ่งพาเซลล์ใดเซลล์หนึ่งมากเกินไป  
- **Normalization:** การปรับข้อมูลให้มีสเกลที่เหมาะสม ซึ่งช่วยให้การฝึกรวดเร็วและมีประสิทธิภาพ

---

## คู่มือการทำงานขั้นตอนต่อขั้นตอน

**ขั้นตอนที่ 1: รู้จักกับโปรเจ็กต์นี้ก่อน**  
ในโปรเจ็กต์นี้ นักเรียนจะได้เรียนรู้การใช้ข้อมูล MNIST ซึ่งเป็นรูปภาพตัวเลขที่เขียนด้วยลายมือ และสร้างโมเดล CNN โดยใช้ PyTorch พร้อมกับ Distributed Data Parallel (DDP) เพื่อฝึกบนหลาย GPU ในซูเปอร์คอมพิวเตอร์

---

**ขั้นตอนที่ 2: ดาวน์โหลดข้อมูล MNIST**  
- เปิดไฟล์ `dataset_download.py` ซึ่งจะทำหน้าที่ดาวน์โหลดข้อมูล MNIST จากอินเทอร์เน็ตไปเก็บไว้ในโฟลเดอร์ที่กำหนด  
- เมื่อรันสคริปต์นี้ โปรแกรมจะเช็คว่ามีไฟล์ข้อมูลอยู่แล้วหรือยัง ถ้าไม่มีจะดาวน์โหลดมาใหม่ให้  
- ให้รันคำสั่งในเทอร์มินัลว่า  
  ```
  python dataset_download.py
  ```  
- เมื่อดาวน์โหลดเสร็จ ระบบจะแจ้งข้อความ “✅ MNIST dataset downloaded successfully!” citeturn0file0

---

**ขั้นตอนที่ 3: สำรวจโค้ดในไฟล์ `DDP.py`**  
- โค้ดในไฟล์นี้จะสร้างโมเดล CNN ที่ประกอบด้วยเลเยอร์คอนโวลูชันและ Fully Connected Layer  
- ฟังก์ชัน `train()` และ `test()` ใช้สำหรับฝึกและทดสอบโมเดลตามลำดับ  
- มีการใช้งาน Distributed Data Parallel (DDP) เพื่อฝึกโมเดลบนหลาย GPU พร้อมกัน ซึ่งช่วยเร่งความเร็วในการฝึก  
- นักเรียนควรอ่านโค้ดและความเห็นในไฟล์นี้เพื่อเข้าใจหลักการทำงานของแต่ละส่วน citeturn0file1

---

**ขั้นตอนที่ 4: เตรียมการรันบนซูเปอร์คอมพิวเตอร์**  
- เปิดไฟล์ `submit.sh` ซึ่งมีคำสั่งสำหรับ SLURM ในการส่งงานบนซูเปอร์คอมพิวเตอร์  
- ในไฟล์นี้ นักเรียนจะได้กำหนดทรัพยากรที่ใช้ (เช่น GPU จำนวน 4 ตัว) และตั้งค่า environment variables ที่จำเป็นสำหรับการใช้งาน DDP  
- เมื่อต้องการรันงาน ให้ใช้คำสั่งในเทอร์มินัลว่า  
  ```
  sbatch submit.sh
  ```  
- ระบบจะจัดสรรทรัพยากรและเริ่มการฝึกโมเดลให้อัตโนมัติ citeturn0file3

---

**ขั้นตอนที่ 5: ดูผลลัพธ์และวิเคราะห์**  
- เมื่อการฝึกเสร็จสิ้น โปรแกรมจะแสดงผลลัพธ์ของการฝึกและทดสอบผ่านทางเทอร์มินัล  
- นักเรียนสามารถสังเกตการลดลงของ loss และการเพิ่มขึ้นของความแม่นยำตามจำนวน epoch ที่กำหนดไว้  
- หากต้องการบันทึกโมเดลสุดท้ายไว้ใช้ในอนาคต สามารถใช้ตัวเลือก `--save-model` ในการรันโปรแกรมได้

---

**ขั้นตอนที่ 6: ลองปรับแต่งและทดลองเพิ่มเติม**  
- นักเรียนสามารถปรับเปลี่ยนพารามิเตอร์ต่าง ๆ เช่น จำนวน epoch, batch size, learning rate หรือแม้กระทั่งโครงสร้างของโมเดล (เช่น การเพิ่มเลเยอร์หรือปรับ dropout) เพื่อดูผลกระทบต่อประสิทธิภาพของโมเดล  
- ดูไฟล์ `load_data.py` เพื่อเข้าใจการโหลดข้อมูลและการแปลง (transform) ข้อมูล ซึ่งเป็นส่วนสำคัญในการเตรียมข้อมูลก่อนฝึก citeturn0file2

---

**สรุป:**  
ตอนนี้นักเรียนได้เรียนรู้ทั้งพื้นฐานทางทฤษฎีและการปฏิบัติในการสร้างและฝึก Neural Network บนซูเปอร์คอมพิวเตอร์แล้ว! จากการดาวน์โหลดข้อมูล MNIST การสร้างโมเดล CNN และการใช้ Distributed Data Parallel (DDP) ในการฝึกบนหลาย GPU นักเรียนจะได้เห็นภาพรวมของการประยุกต์ใช้เทคโนโลยีขั้นสูงในงานวิจัยและอุตสาหกรรม  
ลองทำตามขั้นตอนเหล่านี้ดู แล้วนักเรียนจะได้พบกับโลกแห่งปัญญาประดิษฐ์และสามารถทดลองปรับปรุงนวัตกรรมของตนเองได้อย่างเต็มที่!
